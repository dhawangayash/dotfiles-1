## ~/.config/uzbl/config
## milomouse <vincent[at]fea.st>
## NOTE: basically all of my scripts and handlers require ratpoison.

# - core settings - 
set prefix          = /usr
set shell_cmd       = zsh -c
set bind            = request BIND
set mode_bind       = request MODE_BIND
set mode_config     = request MODE_CONFIG
set on_event        = request ON_EVENT
set progress        = request PROGRESS_CONFIG
set modmap          = request MODMAP
set ignore_key      = request IGNORE_KEY
set modkey_addition = request MODKEY_ADDITION
set toggle_modes    = event TOGGLE_MODES
set set_mode        = set mode =
set set_status      = set status_message =
set scripts_dir     = $XDG_DATA_HOME/uzbl/scripts
set ibind           = @mode_bind insert
set cbind           = @mode_bind command
set ebind           = @mode_bind global,-insert
set new_window      = sh 'uzbl-browser -u $8'

# - added functionality settings - 
set useragent  = Uzbl (Webkit @WEBKIT_MAJOR.@WEBKIT_MINOR.@WEBKIT_MICRO) (@(+uname -o)@ @(+uname -m)@ [@ARCH_UZBL]) (Commit @COMMIT)
set fifo_dir   = $XDG_CACHE_HOME/uzbl
set socket_dir = $XDG_CACHE_HOME/uzbl
set uri        = uzbl.org/doesitwork/@COMMIT

# - disable certain settings despite changes in upstream configuration - 
set scrollbars_visible   = 0
set enforce_96_dpi       = 0
set resizable_text_areas = 0
set autoload_images      = 0
set autoshrink_images    = 0
set http_debug           = 0
set verbose              = 0
set print_events         = 0
set caret_browsing       = 0

# - core handlers - 
set cookie_handler         = talk_to_socket $XDG_CACHE_HOME/uzbl/cookie_daemon_socket
set scheme_handler         = sync_spawn @scripts_dir/scheme.py
set authentication_handler = sync_spawn @scripts_dir/auth.py

# - events - 
@on_event DOWNLOAD_REQUEST spawn @scripts_dir/download_handler %s \@proxy_url
@on_event LOAD_START    @set_status <span foreground="#665c64">wait</span>
@on_event LOAD_COMMIT   @set_status <span foreground="#65bd8b">recv</span>
#@on_event LOAD_COMMIT   script @scripts_dir/scroll-percentage.js
@on_event LOAD_COMMIT   @set_mode
@on_event LOAD_FINISH   @set_status <span foreground="#606060">done</span>
@on_event LOAD_FINISH   spawn @scripts_dir/history_insert-rp
@on_event FORM_ACTIVE   @set_mode command
@on_event ROOT_ACTIVE   @set_mode command

# - behaviour and appearance - 
set show_status       = 1
set status_top        = 0
set status_background = "#000000"
set modcmd_style      = foreground="#98a7b6"
set keycmd_style      = foreground="#98a7b6"
set prompt_style      = foreground="#606060"
set completion_style  = foreground="#665c64"
set cursor_style      = underline="single"
set hint_style        = weight="light"
set mode_section      = <span foreground="#a488d9">Â» [\@[\@mode_indicator]\@]</span>
set keycmd_section    = [<span \@prompt_style>\@[\@keycmd_prompt]\@</span><span \@modcmd_style>\@modcmd</span><span \@keycmd_style>\@keycmd</span><span \@completion_style>\@completion_list</span>]
set progress_section  = <span foreground="#606060">\@[\@progress_format]\@</span>
set scroll_section    = <span foreground="#606060">\@[\@scroll_message]\@</span>
set uri_section       = <span foreground="#65bd8b">\@[\@uri]\@</span>
set name_section      = <span foreground="#a488d9">\@[\@NAME]\@</span>
set status_section    = <span foreground="#606060">\@status_message</span>
set selected_section  = <span foreground="#606060">\@[\@SELECTED_URI]\@</span>
set status_format     = <span font_family="fixed" font_size="small">@mode_section @keycmd_section @progress_section @uri_section @selected_section @name_section @status_section @scroll_section </span>
set title_format_long = \@keycmd_prompt \@raw_modcmd \@raw_keycmd \@TITLE - Uzbl browser <\@NAME> \@SELECTED_URI
@progress width       = 0
@progress format      = %c
@progress done        = 
@progress pending     =

# - key mapping settings - 
@modmap <Control>        <Ctrl>
@modmap <ISO_Left_Tab>   <Shift-Tab>
@modmap <space>          <Space>
@modkey_addition <Shift> <Ctrl>      <Meta>
@modkey_addition <Shift> <Tab>       <Shift-Tab>
@ignore_key <ISO_*>
@ignore_key <Shift>

# - global & keycmd editing binds - 
@bind   <Escape>    = @set_mode
@cbind  i           = @set_mode insert
@ebind  <Return>    = event KEYCMD_EXEC_CURRENT
@ebind  <Home>      = event SET_CURSOR_POS
@ebind  <End>       = event SET_CURSOR_POS -1
@ebind  <Left>      = event SET_CURSOR_POS -
@ebind  <Right>     = event SET_CURSOR_POS +
@ebind  <BackSpace> = event KEYCMD_BACKSPACE
@ebind  <Delete>    = event KEYCMD_DELETE
@ebind  <Tab>       = event START_COMPLETION
@ebind  <Ctrl>w     = event KEYCMD_STRIP_WORD
@ebind  <Ctrl>u     = event SET_KEYCMD
@ebind  <Ctrl>a     = event SET_CURSOR_POS 0
@ebind  <Ctrl>e     = event SET_CURSOR_POS -1

# - basic keyboard bindings - 
@cbind  :_ = %s
@cbind  j  = scroll vertical 20
@cbind  k  = scroll vertical -20
@cbind  h  = scroll horizontal -20
@cbind  l  = scroll horizontal 20
@cbind  K  = scroll vertical -55%
@cbind  J  = scroll vertical 55%
@cbind  gg = scroll vertical begin
@cbind  G  = scroll vertical end
@cbind  0  = scroll horizontal begin
@cbind  $  = scroll horizontal end
@cbind  H  = back
@cbind  L  = forward
@cbind  S  = stop
@cbind  r  = reload
@cbind  R  = reload_ign_cache
@cbind  zi = zoom_in
@cbind  zo = zoom_out
@cbind  Z  = toggle_zoom_type
@cbind  1  = set zoom_level = 1.0
@cbind  2  = set zoom_level = 2.0
@cbind  /* = search %s
@cbind  ?* = search_reverse %s
@cbind  .  = search
@cbind  ,  = search_reverse

# - added functionality binds - 
@cbind  :quit_            = sh "killall xsel && echo exit > $4"
@cbind  !dump             = sh "echo dump_config > $4"
@cbind  !reload           = sh "sed '/^# === Post-load misc commands/,$d' $1 > $4"
@cbind  s<var:>_<value:>_ = set %1 = %2
@cbind  <Ctrl><Alt>t      = sh 'urxvt -e "socat unix-connect:$5 -"'
@cbind  +                 = toggle_status
@cbind  E                 = spawn @scripts_dir/source_view+edit

# - uri binds - 
@cbind  o<uri:>_      = uri %s
@cbind  O<uri:\@uri>_ = uri %s
@cbind  n<new:>_      = sh 'uzbl-browser --uri %s'
@cbind  N<new:\@uri>_ = sh 'uzbl-browser --uri %s'
@cbind  gh  = uri http://www.google.com
@cbind  yu  = sh 'echo -n $6 | xsel'
@cbind  yt  = sh 'echo -n $7 | xsel'
@cbind  ye  = sh 'xsel -x'
@cbind  gP  = sh 'exec uzbl-browser --uri $(xsel --primary -o)'
@cbind  gC  = sh 'exec uzbl-browser --uri $(xsel --clipboard -o)'

# - bookmarks and history binds - 
@cbind  B = spawn @scripts_dir/bookmark_insert-rp
@cbind  U = spawn @scripts_dir/bookmark_load-rp
@cbind  u = spawn @scripts_dir/history_load-rp

# - link following binds - 
set follow_hint_keys = 0123456789
@cbind  fl* = script @scripts_dir/follow.js '@follow_hint_keys %s'

# - web searching binds - 
@cbind  \\google<Google:>_     = uri http://www.google.com/search?q=\@<encodeURIComponent(%r)>\@
@cbind  \\archwiki<Archwiki:>_ = uri http://wiki.archlinux.org/index.php/Special:Search?search=\@<encodeURIComponent(%r)>\@&go=Go
@cbind  \\wiki<Wikipedia:>_    = uri http://en.wikipedia.org/w/index.php?title=Special:Search&search=\@<encodeURIComponent(%r)>\@&go=Go

# - form filler binds - 
@cbind  ti  = spawn @scripts_dir/formfiller
@cbind  te  = spawn @scripts_dir/formfiller edit
@cbind  tn  = spawn @scripts_dir/formfiller new
@cbind  tl  = spawn @scripts_dir/formfiller load

# - some menu entries i'll never use - 
menu_editable_add Open in @external_editor = script @scripts_dir/extedit.js
menu_separator separator_1
menu_add Quit uzbl = sh "killall xsel && echo exit > $4"
menu_link_add Print Link = print \@SELECTED_URI

# - mode configuration - 
set command      = @mode_config command
set insert       = @mode_config insert
set stack        = @mode_config stack
set default_mode = command

# - command mode config - 
@command keycmd_style      = foreground="#b8ddea"
@command status_background = #202020
@command mode_indicator    = Cmd

# - insert mode config - 
@insert  status_background = #303030
@insert  mode_indicator    = Ins

# - multi-stage-binding mode config - 
@stack   keycmd_events     = 1
@stack   modcmd_updates    = 1
@stack   forward_keys      = 0
@stack   keycmd_style      = foreground="#b8ddea"
@stack   prompt_style      = foreground="#888" weight="light"
@stack   status_background = #202020
@stack   mode_indicator    = Bnd

# - examples / reference - 
#@ebind  <Ctrl>su = event INJECT_KEYCMD \@uri
#@ebind  <Ctrl>st = event INJECT_KEYCMD \@title
#@ebind  <Ctrl>du = event APPEND_KEYCMD \@uri
#@ebind  <Ctrl>dt = event APPEND_KEYCMD \@title
