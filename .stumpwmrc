;;----------------------------------------------------------------------------
;; ~/.stumpwmrc
;;----------------------------------------------------------------------------
;; author: milomouse <vincent[at]fea.st>
;; update: 2010-08-29 19:04:44
;;----------------------------------------------------------------------------
;; versions used atoc:
;; |  clisp-new-clx     -> 2.48-2
;; |  ecl (cl-asdf)     -> 10.4.1-1
;; |  cl-ppcre          -> 2.0.3-1
;; |  stumpwm-git       -> 20100825-1
;; |  surfraw-git       -> 20100825-1
;;-TODO:----------------------------------------------------------------------
;; >---: show only CURRENT frame title, not every window, in mode-line.
;; >>>-: create a 'dedicate' and 'catchall' window-rule (remember * *)
;; >>--: create a 'dedicate' and 'catchall' hook for changing focus color.
;; >---: have '(mplayer daemon)' prompts use filename completion
;;----------------------------------------------------------------------------
;; file/s: *data-dir*/{commands,functions,hooks,key-maps,macros}.lisp
;;----------------------------------------------------------------------------


(in-package :stumpwm)
(clear-window-placement-rules)
(defcommand run-shell-command (cmd &optional collect-output-p)
  ((:shell "execute: ")) (if collect-output-p
    (run-prog-collect-output *shell-program* "-c" cmd)
    (run-prog *shell-program* :args (list "-c" cmd) :wait nil)))
(setf *shell-program* "/bin/zsh")
(defcommand-alias exec run-shell-command)

;; -- <module(pre-variables)>
(setf *data-dir* "~/.config/stumpwm/storage/")
(defvar *disk-usage-paths* '("/" "/home" "/var"))
(defvar *disk-modeline-fmt* "^B^8*%a^**^b^0*|^**^B^7*%p^**^b")
(defvar *surfraw-bookmark-file* (data-dir-file "bookmarks" "txt"))

;; -- <scripts>
;(loop for file in '("mplayer-fix")
;      do (load (make-pathname :name file :type "lisp" :directory
;      '(:relative ".config" "stumpwm" "scripts"))))

;; -- <modules>
(loop for file in '("cpu" "disk" "surfraw" "notifications")
      do (load (make-pathname :name file :type "lisp" :directory
      '(:relative ".config" "stumpwm" "modules"))))

;; -- <borders and gravity>
(setf *resize-hides-windows* T
      *normal-border-width* 2
      *maxsize-border-width* 2
      *transient-border-width* 2
      *float-window-border* 1
      *float-window-title-height* 1
      *msg-border-width* 1
      *mouse-focus-policy* :click
      *window-border-style* :thin
      *message-window-gravity* :top-right
      *input-window-gravity* :top-right
      *timeout-wait* 4)

;; -- <fonts/colors>
(set-font "-*-fixed-medium-r-normal-*-10-*-*-*-*-*-*-*")
(set-fg-color        "#a19ea8")
(set-bg-color        "grey15")
(set-border-color    "grey45")
;(set-focus-color     "#d86284")
(set-focus-color     "#d74b73")
;(set-focus-color     "#7965ac")
(set-unfocus-color   "#1c1c1c")
(set-win-bg-color    "#0c0c0c")
(set-win-bg-color    "#020202")
(setf *colors* (list "#1c1c1c"   ;; 0 - black
                     "#d74b73"   ;; 1 - red
                     "#799c99"   ;; 2 - green
                     "#c8bc45"   ;; 3 - yellow
                     "#6c7373"   ;; 4 - blue
                     "#a488d9"   ;; 5 - magenta /or/ #885ed8
                     "#508686"   ;; 6 - cyan
                     "#8d8d8d"   ;; 7 - white
                     "#585872"   ;; 8 - [faint ] magenta
                     "#57718b")) ;; 9 - [bright] blue
;                     "#3d3a3a"   ;; 8 - other
;                     "#b94062")) ;; 9 - other
;(setf *colors* (list "#020202"   ;; 0 - [almost] black
;                     "#a9a6af"   ;; 1 - [faint ] white
;                     "#a883a3"   ;; 2 - [bright] pink
;                     "#7a6c78"   ;; 3 - [faint ] pink
;                     "#57718b"   ;; 4 - [bright] blue
;                     "pink"      ;; 5 - [almost] pink
;                     "#585872"   ;; 6 - [faint ] magenta
;                     "#477289"   ;; 7 - [mild  ] blue
;                     "#555555"   ;; 8 - [mild  ] grey
;                     "#b695f4")) ;; 9 - [bright] magenta
(update-color-map (current-screen))

;; - <text formatting (no mode-line)>
(setf *time-format-string-default* "%A %B %d - %T")
(setf *screen-mode-line-format* nil)
;; -- <text formatting (most of which only works with: *shell-program* /bin/zsh)>
;(setf *screen-mode-line-format*
;      (list "[^B^4*%n^**^b] ^B^7*%C^**^b/" '(:eval (run-shell-command
;      "printf ${${${(@@f)$(</proc/loadavg)[1,3]}//0./^B^9*-.}//./^B^0*.^**}" t)) "^B^7*|^** %D ^B^7*|^B^0* @fea.st: "
;      '(:eval (run-shell-command "ls -1 ~/mail/FastMail/*/new|sed 's|/.*$||'|tr '\\n' ' '|wc -w|tr -d '\\n'" t))
;      " ^B^7*|^** ..^5*/^6*" '(:eval (run-shell-command
;"print -n ${${${${${${$(<~/.config/mifo/log|grep Playing)}// /_}//\\/home\\/milo\\/muzk\\/}//\\\//^5*\/^**}[-1]}[1,80]}"
;      t)) " ^B^7*| ^7*"
;      '(:eval (run-shell-command "print -n ${${$(ossmix|grep outvol)[4,5]}/\)/}" t)) " ^B^7*| ^7*"
;      '(:eval (run-shell-command "date '+%Y-%m-%d^B^6*/^0*%a^5* |^**^b %T'|tr -d '\\n'" t))))
(setf
*startup-message* "^B^1*together we ate the king^**^b:^B^5*and laughed ourselves to death^**^b"
*group-format*    "^B^8*%t^7*%s^07|^**^b"
*window-format*   "^B^27%s^0*%16t^**^b")

;; -- <windows/frames>
(setf *default-window-name* "null"
      *normal-gravity* :top-right
      *maxsize-gravity* :top-right
      *transient-gravity* :center
      *new-frame-action* :empty
      *min-frame-width* 100
      *min-frame-height* 50
      *resize-increment* 10)

;; -- <mode-line/input>
(setf *mode-line-background-color* "grey13"
      *mode-line-border-color* "grey25"
      *mode-line-foreground-color* "#a9a6af"
      *mode-line-border-width* 1
      *mode-line-pad-x* 1
      *mode-line-pad-y* 0
      *mode-line-timeout* 1
      *mode-line-position* :top
      *input-history-ignore-duplicates* 0)

;; -- <load external settings' file/s>
(loop for file in '("functions" "macros" "commands" "hooks" "key-maps")
      do (load (make-pathname :name file :type "lisp" :directory
      '(:relative ".config" "stumpwm"))))

;; -- <screens/workspaces>
;(run-shell-command "[[ -n $(pgrep dzen) ]] || . .xmonad/dzen4xmonad &")

;; -- <show mode-line if not already shown>
;(if (not (head-mode-line (current-head)))
;  (toggle-mode-line (current-screen) (current-head)))

;; -- <hide mode-line>
(run-commands "toggle-mode-line")

;(setf *frame-number-map* "123456")
(setf (group-name (first (screen-groups (current-screen)))) "1")
(make-groups-bg "2" "3" "4" "5" "6")
(restore-from-file (data-dir-file "screen_data_last"))

